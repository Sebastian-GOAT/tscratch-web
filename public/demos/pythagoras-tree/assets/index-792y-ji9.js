(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();var i=document.getElementById("game-window"),c=i.getContext("2d"),u=document.createElement("canvas"),a=u.getContext("2d");u.id="pen-canvas";var M=16/9,d;function z(e){d=e,i.width=M*d,i.height=d,u.width=M*d,u.height=d}i.parentElement?.insertBefore(u,i);z(500);var y=class{x;y;dir;scene;hidden;layer;refresh(){p.init().refresh()}constructor(e){this.x=e?.x??0,this.y=e?.y??0,this.dir=e?.dir??0,this.scene=e?.scene??"main",this.hidden=e?.hidden??!1,this.layer=e?.layer??0,p.init().addSprite(this)}toRadians(e){return e*Math.PI/180}toDegrees(e){return e*180/Math.PI}move(e){this.x+=e*Math.sin(this.toRadians(this.dir)),this.y+=e*Math.cos(this.toRadians(this.dir)),this.refresh()}turn(e){this.dir+=e,this.refresh()}point(e){this.dir=e,this.refresh()}setX(e){this.x=e,this.refresh()}setY(e){this.y=e,this.refresh()}goTo(e,t){this.x=e,this.y=t,this.refresh()}changeX(e){this.x+=e,this.refresh()}changeY(e){this.y+=e,this.refresh()}show(){this.hidden=!1,this.refresh()}hide(){this.hidden=!0,this.refresh()}goToLayer(e){this.layer=e,this.refresh()}changeLayer(e){this.layer+=e,this.refresh()}},p=class S{static instance;loopRunning=!1;gameLoop=null;maxFPS=24;mouseX=0;mouseY=0;mouseDown=!1;currentScene="main";sceneMap={};static init(){return this.instance||(this.instance=new S),this.instance}changeScene(t){this.sceneMap[t]||(this.sceneMap[t]={sprites:[],loop:null}),this.loopRunning=!1,this.currentScene=t,this.gameLoop=this.sceneMap[t].loop,this.setMaxFramesPerSecond(this.maxFPS)}setLoop(t,s){if(!this.sceneMap[t]){this.sceneMap[t]={sprites:[],loop:s},t===this.currentScene&&this.changeScene(t);return}this.sceneMap[t].loop=s,t===this.currentScene&&this.changeScene(t)}addSprite(t){let{scene:s,layer:o}=t;if(!this.sceneMap[s]){this.sceneMap[s]={sprites:[t],loop:null};return}let r=this.sceneMap[s].sprites.findIndex(n=>n.layer>o);if(r===-1){this.sceneMap[s].sprites.push(t);return}this.sceneMap[s].sprites.splice(r,0,t)}async setMaxFramesPerSecond(t){this.maxFPS=t;let s=this.gameLoop;if(s)for(this.loopRunning=!0;this.loopRunning;)await s(),await this.wait(1e3/t)}refresh(){c.clearRect(0,0,i.width,i.height),this.sceneMap[this.currentScene]?.sprites.forEach(t=>{t.hidden||t.draw()})}async wait(t){return new Promise(s=>setTimeout(s,t))}isHovered(t){let{mouseX:s,mouseY:o}=this,r=s+i.width/2,n=i.height/2-o,l=r-(t.x+i.width/2),x=n-(i.height/2-t.y),f=-this.toRadians(t.dir),P=l*Math.cos(f)-x*Math.sin(f),R=l*Math.sin(f)+x*Math.cos(f);return c.isPointInPath(t.getPath(),P,R)}pickRandom(t,s){return t>s&&([t,s]=[s,t]),Math.floor(Math.random()*(s-t+1)+t)}sin(t){return Math.sin(this.toRadians(t))}cos(t){return Math.cos(this.toRadians(t))}tan(t){return Math.tan(this.toRadians(t))}csc(t){return 1/Math.sin(this.toRadians(t))}sec(t){return 1/Math.cos(this.toRadians(t))}cot(t){return 1/Math.tan(this.toRadians(t))}asin(t){return this.toDegrees(Math.asin(t))}acos(t){return this.toDegrees(Math.acos(t))}acsc(t){return this.toDegrees(Math.asin(1/t))}asec(t){return this.toDegrees(Math.acos(1/t))}toRadians(t){return t*Math.PI/180}toDegrees(t){return t*180/Math.PI}constructor(){this.setMaxFramesPerSecond(24),i.addEventListener("mousemove",t=>{this.mouseX=t.clientX-i.offsetLeft-i.width/2,this.mouseY=-(t.clientY-i.offsetTop-i.height/2)}),i.addEventListener("mousedown",t=>{this.mouseDown=!0}),i.addEventListener("mouseup",t=>{this.mouseDown=!1})}},F=class extends y{width;height;color;getPath(){let e=new Path2D;return e.rect(-this.width/2,-this.height/2,this.width,this.height),e}draw(e){let t=e?a:c;t.save();let s=this.x+i.width/2,o=-this.y+i.height/2;t.translate(s,o),t.rotate(this.toRadians(this.dir)),t.fillStyle=this.color,t.fill(this.getPath()),t.restore()}setWidth(e){this.width=e,this.refresh()}setHeight(e){this.height=e,this.refresh()}setColor(e){this.color=e,this.refresh()}constructor(e){super(e),this.width=e?.width??50,this.height=e?.height??50,this.color=e?.color??"black",this.draw()}},L=class extends y{drawing;size;color;getPath(){return new Path2D}draw(){}up(){this.drawing=!1}down(){this.drawing=!0}stamp(e){e.draw(!0)}ereaseAll(){a.clearRect(0,0,i.width,i.height)}dot(){a.fillStyle=this.color,a.fillRect(this.x-this.size/2+i.width/2,-this.y-this.size/2+i.height/2,this.size,this.size)}drawLine(e,t){a.beginPath(),a.moveTo(e+i.width/2,-t+i.height/2),a.lineTo(this.x+i.width/2,-this.y+i.height/2),a.lineWidth=this.size,a.strokeStyle=this.color,a.stroke()}move(e){let t=this.x,s=this.y;this.x+=e*Math.sin(this.toRadians(this.dir)),this.y+=e*Math.cos(this.toRadians(this.dir)),this.drawing&&this.drawLine(t,s),this.refresh()}setX(e){let t=this.x,s=this.y;this.x=e,this.drawing&&this.drawLine(t,s),this.refresh()}setY(e){let t=this.x,s=this.y;this.y=e,this.drawing&&this.drawLine(t,s),this.refresh()}goTo(e,t){let s=this.x,o=this.y;this.x=e,this.y=t,this.drawing&&this.drawLine(s,o),this.refresh()}changeX(e){let t=this.x,s=this.y;this.x+=e,this.drawing&&this.drawLine(t,s),this.refresh()}changeY(e){let t=this.x,s=this.y;this.y+=e,this.drawing&&this.drawLine(t,s),this.refresh()}constructor(e){super(e),this.drawing=e?.drawing??!1,this.size=e?.size??5,this.color=e?.color??"black"}},D=class extends y{content;color;fontFamily;fontSize;align;baseline;font;getPath(){let e=new Path2D;c.save(),c.font=this.font;let t=c.measureText(this.content),s=t.width,o=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;return c.restore(),e.rect(-s/2,-o/2,s,o),e}draw(e){let t=e?a:c;t.save();let s=this.x+i.width/2,o=-this.y+i.height/2;t.translate(s,o),t.rotate(this.toRadians(this.dir)),t.font=this.font,t.fillStyle=this.color,t.textAlign=this.align,t.textBaseline=this.baseline,t.fillText(this.content,0,0),t.restore()}setContent(e){this.content=e,this.refresh()}setColor(e){this.color=e,this.refresh()}setFontSize(e){this.fontSize=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setFontFamily(e){this.fontFamily=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setAlign(e){this.align=e,this.refresh()}setBaseline(e){this.baseline=e,this.refresh()}constructor(e){super(e),this.content=e?.content??"",this.color=e?.color??"black",this.fontFamily=e?.fontFamily??"Arial",this.fontSize=e?.fontSize??16,this.align=e?.align??"center",this.baseline=e?.baseline??"middle",this.font=`${this.fontSize}px ${this.fontFamily}`}};const g=p.init(),w=100,b=10,v=0,h=new F({y:-i.height/2+w,width:w,height:w,hidden:!0}),T=new L;new D({content:"Made with TScratch",x:-i.width/2+5,y:i.height/2-5,align:"left",baseline:"top"});m(0,h.width);async function m(e,t){if(e>b)return;h.setWidth(t),h.setHeight(t),T.stamp(h);const s=h.x,o=h.y,r=h.dir;h.turn(-90),h.move(t/2),h.turn(90),h.move(t/2);const n=t/(2*g.cos(45));h.turn(45),h.move(n/2),h.turn(-90),h.move(n/2),await g.wait(v),await m(e+1,n),h.goTo(s,o),h.point(r),h.turn(90),h.move(t/2),h.turn(-90),h.move(t/2),h.turn(-45),h.move(n/2),h.turn(90),h.move(n/2),await g.wait(v),await m(e+1,n)}
