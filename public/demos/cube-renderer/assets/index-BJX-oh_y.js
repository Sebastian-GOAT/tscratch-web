(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();var o=document.getElementById("game-window")||document.createElement("canvas"),M=o.getContext("2d"),g=document.createElement("canvas"),p=g.getContext("2d");g.id="pen-canvas";var C=16/9,v;function O(e){v=e,o.width=C*v,o.height=v,g.width=C*v,g.height=v}o.parentElement?.insertBefore(g,o);O(500);var Z=class{x;y;dir;scene;hidden;layer;refresh(){X.init().refresh()}constructor(e){this.x=e?.x??0,this.y=e?.y??0,this.dir=e?.dir??0,this.scene=e?.scene??"main",this.hidden=e?.hidden??!1,this.layer=e?.layer??0,X.init().addSprite(this)}touching(e){let t=this.getBoundingBox(),s=e.getBoundingBox();if(!(Math.abs(t.x-s.x)<(t.width+s.width)/2&&Math.abs(t.y-s.y)<(t.height+s.height)/2))return!1;let r=t.x-t.width/2,i=t.y+t.height/2,n=t.x+t.width/2,h=t.y-t.height/2,a=s.x-s.width/2,w=s.y+s.height/2,c=s.x+s.width/2,d=s.y-s.height/2,l=Math.max(r,a),S=Math.min(h,d),z=Math.min(n,c),R=Math.max(i,w),P=z-l,y=R-S;if(P<=1||y<=1)return!1;let F=document.createElement("canvas");F.width=P,F.height=y;let u=F.getContext("2d",{willReadFrequently:!0});u.save(),u.translate(this.x-l,y-this.y+S),u.rotate(this.toRadians(this.dir)),u.fillStyle="red",u.fill(this.getPath()),u.restore();let Y=u.getImageData(0,0,P,y).data;u.clearRect(0,0,P,y),u.save(),u.translate(e.x-l,y-e.y+S),u.rotate(this.toRadians(e.dir)),u.fillStyle="blue",u.fill(e.getPath()),u.restore();let E=u.getImageData(0,0,P,y).data;for(let B=3;B<Y.length;B+=4)if(Y[B]>0&&E[B]>0)return!0;return!1}toRadians(e){return e*Math.PI/180}toDegrees(e){return e*180/Math.PI}move(e){this.x+=e*Math.sin(this.toRadians(this.dir)),this.y+=e*Math.cos(this.toRadians(this.dir)),this.refresh()}turn(e){this.dir+=e,this.refresh()}point(e){this.dir=e,this.refresh()}pointTowards(e,t){this.dir=90-this.toDegrees(Math.atan2(t,e)),this.refresh()}setX(e){this.x=e,this.refresh()}setY(e){this.y=e,this.refresh()}goTo(e,t){this.x=e,this.y=t,this.refresh()}changeX(e){this.x+=e,this.refresh()}changeY(e){this.y+=e,this.refresh()}show(){this.hidden=!1,this.refresh()}hide(){this.hidden=!0,this.refresh()}goToLayer(e){this.layer=e,this.refresh()}changeLayer(e){this.layer+=e,this.refresh()}},X=class ${static instance;loopRunning=!1;gameLoop=null;maxFPS=24;deltaTime=1/this.maxFPS;lastFrame=performance.now();sounds=[];mouseX=0;mouseY=0;mouseDown=!1;mouseClicked=!1;keysPressed=new Set;currentScene="main";sceneMap={};static init(){return this.instance||(this.instance=new $),this.instance}changeScene(t){this.sceneMap[t]||(this.sceneMap[t]={sprites:[],loop:null}),this.loopRunning=!1,this.currentScene=t,this.gameLoop=this.sceneMap[t].loop,this.setMaxFramesPerSecond(this.maxFPS)}setLoop(t,s){if(!this.sceneMap[t]){this.sceneMap[t]={sprites:[],loop:s},t===this.currentScene&&this.changeScene(t);return}this.sceneMap[t].loop=s,t===this.currentScene&&this.changeScene(t)}pauseLoop(){this.loopRunning=!1}resumeLoop(){this.loopRunning=!0,this.setMaxFramesPerSecond(this.maxFPS)}addSprite(t){let{scene:s,layer:r}=t;if(!this.sceneMap[s]){this.sceneMap[s]={sprites:[t],loop:null};return}let i=this.sceneMap[s].sprites.findIndex(n=>n.layer>r);if(i===-1){this.sceneMap[s].sprites.push(t);return}this.sceneMap[s].sprites.splice(i,0,t),this.refresh()}removeSprite(t){let{scene:s}=t;this.sceneMap[s]&&(this.sceneMap[s].sprites=this.sceneMap[s].sprites.filter(r=>r!==t),this.refresh())}async setMaxFramesPerSecond(t){this.maxFPS=t;let s=this.gameLoop;if(s)for(this.loopRunning=!0;this.loopRunning;){let r=this.lastFrame,i=performance.now();this.deltaTime=(i-r)/1e3,this.lastFrame=i,await s(),await this.wait(1e3/t)}}refresh(){M.clearRect(0,0,o.width,o.height),[...this.sceneMap[this.currentScene]?.sprites??[],...this.sceneMap["*"]?.sprites??[]].forEach(t=>{t.hidden||t.draw()})}async wait(t){return new Promise(s=>setTimeout(s,t))}async waitUntil(t){return new Promise(s=>{let r=()=>{t()?s():setTimeout(r,1e3/this.maxFPS)};r()})}hovering(t){let{mouseX:s,mouseY:r}=this,i=s+o.width/2,n=o.height/2-r,h=i-(t.x+o.width/2),a=n-(o.height/2-t.y),w=-this.toRadians(t.dir),c=h*Math.cos(w)-a*Math.sin(w),d=h*Math.sin(w)+a*Math.cos(w);return M.isPointInPath(t.getPath(),c,d)}keyPressed(t){return this.keysPressed.has(t)}playSound(t){let s=new Audio(t);return this.sounds.push(s),s.play(),s}stopSound(t){t.pause(),t.currentTime=0,this.sounds=this.sounds.filter(s=>s!==t)}stopAllSounds(){this.sounds.forEach(t=>{t.pause(),t.currentTime=0}),this.sounds=[]}pickRandom(t,s){return t>s&&([t,s]=[s,t]),Math.floor(Math.random()*(s-t+1)+t)}sin(t){return Math.sin(this.toRadians(t))}cos(t){return Math.cos(this.toRadians(t))}tan(t){return Math.tan(this.toRadians(t))}csc(t){return 1/Math.sin(this.toRadians(t))}sec(t){return 1/Math.cos(this.toRadians(t))}cot(t){return 1/Math.tan(this.toRadians(t))}asin(t){return this.toDegrees(Math.asin(t))}acos(t){return this.toDegrees(Math.acos(t))}acsc(t){return this.toDegrees(Math.asin(1/t))}asec(t){return this.toDegrees(Math.acos(1/t))}toRadians(t){return t*Math.PI/180}toDegrees(t){return t*180/Math.PI}constructor(){this.setMaxFramesPerSecond(24),g.addEventListener("mousemove",t=>{this.mouseX=t.clientX-g.offsetLeft-g.width/2,this.mouseY=-(t.clientY-g.offsetTop-g.height/2)}),g.addEventListener("mousedown",t=>{this.mouseDown=!0}),g.addEventListener("mouseup",t=>{this.mouseDown=!1}),g.addEventListener("click",t=>{this.mouseClicked=!0,setTimeout(()=>this.mouseClicked=!1,0)}),addEventListener("keydown",t=>{t.repeat||this.keysPressed.add(t.key)}),addEventListener("keyup",t=>{this.keysPressed.delete(t.key)})}},V=class extends Z{discriminant="pen";drawing;size;color;getBoundingBox(){return{x:this.x,y:this.y,width:this.size,height:this.size}}getPath(){return new Path2D}draw(){}up(){this.drawing=!1}down(){this.drawing=!0}stamp(e){e.draw(!0)}ereaseAll(){p.clearRect(0,0,o.width,o.height)}dot(){p.fillStyle=this.color,p.fillRect(this.x-this.size/2+o.width/2,-this.y-this.size/2+o.height/2,this.size,this.size)}drawLine(e,t){p.beginPath(),p.moveTo(e+o.width/2,-t+o.height/2),p.lineTo(this.x+o.width/2,-this.y+o.height/2),p.lineWidth=this.size,p.strokeStyle=this.color,p.stroke()}move(e){let t=this.x,s=this.y;this.x+=e*Math.sin(this.toRadians(this.dir)),this.y+=e*Math.cos(this.toRadians(this.dir)),this.drawing&&this.drawLine(t,s),this.refresh()}setX(e){let t=this.x,s=this.y;this.x=e,this.drawing&&this.drawLine(t,s),this.refresh()}setY(e){let t=this.x,s=this.y;this.y=e,this.drawing&&this.drawLine(t,s),this.refresh()}goTo(e,t){let s=this.x,r=this.y;this.x=e,this.y=t,this.drawing&&this.drawLine(s,r),this.refresh()}changeX(e){let t=this.x,s=this.y;this.x+=e,this.drawing&&this.drawLine(t,s),this.refresh()}changeY(e){let t=this.x,s=this.y;this.y+=e,this.drawing&&this.drawLine(t,s),this.refresh()}constructor(e){super(e),this.drawing=e?.drawing??!1,this.size=e?.size??5,this.color=e?.color??"black"}},j=class extends Z{discriminant="text";content;color;fontFamily;fontSize;align;baseline;font;getBoundingBox(){let e=M.measureText(this.content),t=e.width,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;return{x:this.x,y:this.y,width:t,height:s}}getPath(){let e=new Path2D;M.save(),M.font=this.font;let t=M.measureText(this.content),s=t.width,r=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;return M.restore(),e.rect(-s/2,-r/2,s,r),e}draw(e){let t=e?p:M;t.save();let s=this.x+o.width/2,r=-this.y+o.height/2;t.translate(s,r),t.rotate(this.toRadians(this.dir)),t.font=this.font,t.fillStyle=this.color,t.textAlign=this.align,t.textBaseline=this.baseline,t.fillText(this.content,0,0),t.restore()}setContent(e){this.content=e,this.refresh()}setColor(e){this.color=e,this.refresh()}setFontSize(e){this.fontSize=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setFontFamily(e){this.fontFamily=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setAlign(e){this.align=e,this.refresh()}setBaseline(e){this.baseline=e,this.refresh()}constructor(e){super(e),this.content=e?.content??"",this.color=e?.color??"black",this.fontFamily=e?.fontFamily??"Arial",this.fontSize=e?.fontSize??16,this.align=e?.align??"center",this.baseline=e?.baseline??"middle",this.font=`${this.fontSize}px ${this.fontFamily}`,this.draw()}};const A=X.init(),N=16/9,I=60,T=.01,b=1e4,W=[[()=>N*A.tan(I/2),()=>0,()=>0,()=>0],[()=>0,()=>A.cot(I/2),()=>0,()=>0],[()=>0,()=>0,()=>(b+T)/(T-b),()=>2*b*T/(T-b)],[()=>0,()=>0,()=>-1,()=>0]],m=X.init(),q=[[e=>1,e=>0,e=>0],[e=>0,e=>m.cos(e),e=>-m.sin(e)],[e=>0,e=>m.sin(e),e=>m.cos(e)]],K=[[e=>m.cos(e),e=>0,e=>m.sin(e)],[e=>0,e=>1,e=>0],[e=>-m.sin(e),e=>0,e=>m.cos(e)]],U=[[e=>m.cos(e),e=>-m.sin(e),e=>0],[e=>m.sin(e),e=>m.cos(e),e=>0],[e=>0,e=>0,e=>1]];class f{x;y;static dot(t,s){return t.x*s.x+t.y*s.y}constructor(t,s){this.x=t,this.y=s}}class x{x;y;z;static dot(t,s){return t.x*s.x+t.y*s.y+t.z*s.z}constructor(t,s,r){this.x=t,this.y=s,this.z=r}}class L{x;y;z;w;static dot(t,s){return t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w}constructor(t,s,r,i){this.x=t,this.y=s,this.z=r,this.w=i}}class G extends V{scale;rotationX;rotationY;rotationZ;vertices;edges;render(){const t=this.getRotatedVertices(),s=this.getProjectedVertices(t);for(const r of this.edges){const i=s[r.x].x*this.scale,n=s[r.x].y*this.scale,h=s[r.y].x*this.scale,a=s[r.y].y*this.scale;this.goTo(i,n),this.down(),this.goTo(h,a),this.up()}}setColor(t){this.color=t,this.update()}rotateX(t){this.rotationX=(this.rotationX+t)%360,this.update()}rotateY(t){this.rotationY=(this.rotationY+t)%360,this.update()}rotateZ(t){this.rotationZ=(this.rotationZ+t)%360,this.update()}getProjectedVertices(t){const s=t.map(i=>new L(i.x,i.y,i.z,1)),r=[];for(const i of s){const n=W,h=new L(i.x,i.y,i.z,1),a=new L(n[0][0](),n[0][1](),n[0][2](),n[0][3]()),w=new L(n[1][0](),n[1][1](),n[1][2](),n[1][3]()),c=new L(n[2][0](),n[2][1](),n[2][2](),n[2][3]()),d=new L(n[3][0](),n[3][1](),n[3][2](),n[3][3]()),l=f.dot(a,h),S=f.dot(w,h);f.dot(c,h);const z=f.dot(d,h),R=z!==0?1/z:1;r.push(new f(l*R,S*R))}return r}getRotatedVertices(){const t=[],s=q,r=K,i=U,n=this.rotationX,h=this.rotationY,a=this.rotationZ;for(const w of this.vertices){let c=w.x,d=w.y,l=w.z,S=s[0][0](n)*c+s[0][1](n)*d+s[0][2](n)*l,z=s[1][0](n)*c+s[1][1](n)*d+s[1][2](n)*l,R=s[2][0](n)*c+s[2][1](n)*d+s[2][2](n)*l;c=S,d=z,l=R;let P=r[0][0](h)*c+r[0][1](h)*d+r[0][2](h)*l,y=r[1][0](h)*c+r[1][1](h)*d+r[1][2](h)*l,F=r[2][0](h)*c+r[2][1](h)*d+r[2][2](h)*l;c=P,d=y,l=F;let u=i[0][0](a)*c+i[0][1](a)*d+i[0][2](a)*l,Y=i[1][0](a)*c+i[1][1](a)*d+i[1][2](a)*l,E=i[2][0](a)*c+i[2][1](a)*d+i[2][2](a)*l;t.push(new x(u,Y,E))}return t}update(){this.ereaseAll(),this.render()}constructor(t){super(t),this.scale=t?.scale??100,this.rotationX=t?.rotationX??0,this.rotationY=t?.rotationY??0,this.rotationZ=t?.rotationZ??0,this.vertices=t?.vertices??[],this.edges=t?.edges??[],this.render()}}const H=[new x(-1,-1,-1),new x(1,-1,-1),new x(1,-1,1),new x(-1,-1,1),new x(-1,1,-1),new x(1,1,-1),new x(1,1,1),new x(-1,1,1)],J=[new f(0,1),new f(1,2),new f(2,3),new f(3,0),new f(4,5),new f(5,6),new f(6,7),new f(7,4),new f(0,4),new f(1,5),new f(2,6),new f(3,7)],k=X.init(),Q=10,_=75;new j({content:"Made with TScratch",x:-o.width/2+5,y:o.height/2-5,align:"left",baseline:"top"});const D=new G({vertices:H,edges:J,scale:_,size:Q});k.setLoop("main",()=>{D.rotateX(1),D.rotateY(1),D.rotateZ(1);const e=k.pickRandom(0,255),t=k.pickRandom(0,255),s=k.pickRandom(0,255);D.setColor(`rgb(${e}, ${t}, ${s})`)});
