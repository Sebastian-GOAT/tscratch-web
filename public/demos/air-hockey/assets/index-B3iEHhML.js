(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(i){if(i.ep)return;i.ep=!0;const h=s(i);fetch(i.href,h)}})();var r=document.getElementById("game-window"),l=r.getContext("2d"),o=document.createElement("canvas"),g=o.getContext("2d");o.id="pen-canvas";var p=16/9,u;function L(e){u=e,r.width=p*u,r.height=u,o.width=p*u,o.height=u}r.parentElement?.insertBefore(o,r);L(500);var y=class{x;y;dir;scene;hidden;layer;refresh(){f.init().refresh()}constructor(e){this.x=e?.x??0,this.y=e?.y??0,this.dir=e?.dir??0,this.scene=e?.scene??"main",this.hidden=e?.hidden??!1,this.layer=e?.layer??0,f.init().addSprite(this)}toRadians(e){return e*Math.PI/180}toDegrees(e){return e*180/Math.PI}move(e){this.x+=e*Math.sin(this.toRadians(this.dir)),this.y+=e*Math.cos(this.toRadians(this.dir)),this.refresh()}turn(e){this.dir+=e,this.refresh()}point(e){this.dir=e,this.refresh()}setX(e){this.x=e,this.refresh()}setY(e){this.y=e,this.refresh()}goTo(e,t){this.x=e,this.y=t,this.refresh()}changeX(e){this.x+=e,this.refresh()}changeY(e){this.y+=e,this.refresh()}show(){this.hidden=!1,this.refresh()}hide(){this.hidden=!0,this.refresh()}goToLayer(e){this.layer=e,this.refresh()}changeLayer(e){this.layer+=e,this.refresh()}},f=class m{static instance;loopRunning=!1;gameLoop=null;maxFPS=24;sounds=[];mouseX=0;mouseY=0;mouseDown=!1;currentScene="main";sceneMap={};static init(){return this.instance||(this.instance=new m),this.instance}changeScene(t){this.sceneMap[t]||(this.sceneMap[t]={sprites:[],loop:null}),this.loopRunning=!1,this.currentScene=t,this.gameLoop=this.sceneMap[t].loop,this.setMaxFramesPerSecond(this.maxFPS)}setLoop(t,s){if(!this.sceneMap[t]){this.sceneMap[t]={sprites:[],loop:s},t===this.currentScene&&this.changeScene(t);return}this.sceneMap[t].loop=s,t===this.currentScene&&this.changeScene(t)}addSprite(t){let{scene:s,layer:n}=t;if(!this.sceneMap[s]){this.sceneMap[s]={sprites:[t],loop:null};return}let i=this.sceneMap[s].sprites.findIndex(h=>h.layer>n);if(i===-1){this.sceneMap[s].sprites.push(t);return}this.sceneMap[s].sprites.splice(i,0,t),this.refresh()}removeSprite(t){let{scene:s}=t;this.sceneMap[s]&&(this.sceneMap[s].sprites=this.sceneMap[s].sprites.filter(n=>n!==t),this.refresh())}async setMaxFramesPerSecond(t){this.maxFPS=t;let s=this.gameLoop;if(s)for(this.loopRunning=!0;this.loopRunning;)await s(),await this.wait(1e3/t)}refresh(){l.clearRect(0,0,r.width,r.height),this.sceneMap[this.currentScene]?.sprites.forEach(t=>{t.hidden||t.draw()})}async wait(t){return new Promise(s=>setTimeout(s,t))}isHovered(t){let{mouseX:s,mouseY:n}=this,i=s+r.width/2,h=r.height/2-n,a=i-(t.x+r.width/2),d=h-(r.height/2-t.y),c=-this.toRadians(t.dir),w=a*Math.cos(c)-d*Math.sin(c),S=a*Math.sin(c)+d*Math.cos(c);return l.isPointInPath(t.getPath(),w,S)}playSound(t){let s=new Audio(t);return this.sounds.push(s),s.play(),s}stopSound(t){t.pause(),t.currentTime=0,this.sounds=this.sounds.filter(s=>s!==t)}stopAllSounds(){this.sounds.forEach(t=>{t.pause(),t.currentTime=0}),this.sounds=[]}pickRandom(t,s){return t>s&&([t,s]=[s,t]),Math.floor(Math.random()*(s-t+1)+t)}sin(t){return Math.sin(this.toRadians(t))}cos(t){return Math.cos(this.toRadians(t))}tan(t){return Math.tan(this.toRadians(t))}csc(t){return 1/Math.sin(this.toRadians(t))}sec(t){return 1/Math.cos(this.toRadians(t))}cot(t){return 1/Math.tan(this.toRadians(t))}asin(t){return this.toDegrees(Math.asin(t))}acos(t){return this.toDegrees(Math.acos(t))}acsc(t){return this.toDegrees(Math.asin(1/t))}asec(t){return this.toDegrees(Math.acos(1/t))}toRadians(t){return t*Math.PI/180}toDegrees(t){return t*180/Math.PI}constructor(){this.setMaxFramesPerSecond(24),o.addEventListener("mousemove",t=>{this.mouseX=t.clientX-o.offsetLeft-o.width/2,this.mouseY=-(t.clientY-o.offsetTop-o.height/2)}),o.addEventListener("mousedown",t=>{this.mouseDown=!0}),o.addEventListener("mouseup",t=>{this.mouseDown=!1})}},P=class extends y{radA;radB;color;outlineColor;outlineWidth;getPath(){let e=new Path2D;return e.ellipse(0,0,this.radA,this.radB,0,0,Math.PI*2),e}draw(e){let t=e?g:l;t.save();let s=this.x+r.width/2,n=-this.y+r.height/2;t.translate(s,n),t.rotate(this.toRadians(this.dir));let i=this.getPath();t.fillStyle=this.color,t.strokeStyle=this.outlineColor,t.lineWidth=this.outlineWidth,t.fill(i),this.outlineWidth&&t.stroke(i),t.restore()}setRadA(e){this.radA=e,this.refresh()}setRadB(e){this.radB=e,this.refresh()}setColor(e){this.color=e,this.refresh()}constructor(e){super(e),this.radA=e?.radA??25,this.radB=e?.radB??25,this.color=e?.color??"black",this.outlineColor=e?.outlineColor??"black",this.outlineWidth=e?.outlineWidth??0,this.draw()}},E=class extends y{content;color;fontFamily;fontSize;align;baseline;font;getPath(){let e=new Path2D;l.save(),l.font=this.font;let t=l.measureText(this.content),s=t.width,n=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;return l.restore(),e.rect(-s/2,-n/2,s,n),e}draw(e){let t=e?g:l;t.save();let s=this.x+r.width/2,n=-this.y+r.height/2;t.translate(s,n),t.rotate(this.toRadians(this.dir)),t.font=this.font,t.fillStyle=this.color,t.textAlign=this.align,t.textBaseline=this.baseline,t.fillText(this.content,0,0),t.restore()}setContent(e){this.content=e,this.refresh()}setColor(e){this.color=e,this.refresh()}setFontSize(e){this.fontSize=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setFontFamily(e){this.fontFamily=e,this.font=`${this.fontSize}px ${this.fontFamily}`,this.refresh()}setAlign(e){this.align=e,this.refresh()}setBaseline(e){this.baseline=e,this.refresh()}constructor(e){super(e),this.content=e?.content??"",this.color=e?.color??"black",this.fontFamily=e?.fontFamily??"Arial",this.fontSize=e?.fontSize??16,this.align=e?.align??"center",this.baseline=e?.baseline??"middle",this.font=`${this.fontSize}px ${this.fontFamily}`}};class M extends P{vX;vY;glidingEnergyLoss;collisionEnergyLoss;radius;color;constructor(t){super(t),this.vX=t?.vX??0,this.vY=t?.vY??0,this.glidingEnergyLoss=t?.glidingEnergyLoss??.95,this.collisionEnergyLoss=t?.collisionEnergyLoss??.3,this.radius=t?.radius??10,this.radA=t?.radA??this.radius,this.radB=t?.radB??this.radius,this.color=t?.color??"black"}}class R extends M{update(){const{mouseX:t,mouseY:s}=f.init();this.vX=t-this.x,this.vY=s-this.y,this.goTo(t,s)}constructor(t){super(t)}}class F extends M{player;update(){const t=f.init(),s=this.radius+this.player.radius-Math.hypot(this.x-this.player.x,this.y-this.player.y);if(s>=0){const d=Math.hypot(this.player.vX*this.collisionEnergyLoss,this.player.vY*this.collisionEnergyLoss);this.point(90-t.toDegrees(Math.atan2(this.player.y-this.y,this.player.x-this.x))),this.turn(180);const c=this.dir;this.move(s),this.vX+=d*t.sin(c),this.vY+=d*t.cos(c)}const n=r.width/2,i=r.height/2,h=Math.max(0,Math.abs(this.x)+this.radius-n);h&&(this.x-=Math.sign(this.x)*h,this.vX*=-this.collisionEnergyLoss);const a=Math.max(0,Math.abs(this.y)+this.radius-i);a&&(this.y-=Math.sign(this.y)*a,this.vY*=-this.collisionEnergyLoss),this.vX*=this.glidingEnergyLoss,this.vY*=this.glidingEnergyLoss,this.changeX(this.vX),this.changeY(this.vY)}constructor(t){super(t),this.player=t.player}}const x=f.init();x.setMaxFramesPerSecond(60);new E({content:"Made with TScratch",x:-r.width/2+5,y:r.height/2-5,align:"left",baseline:"top"});const v=new R({color:"red",radius:30,outlineWidth:3}),X=new F({player:v,radius:15});x.setLoop("main",()=>{X.update(),v.update()});
