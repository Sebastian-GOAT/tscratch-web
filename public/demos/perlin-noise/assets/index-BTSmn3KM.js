(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var a=document.getElementById("game-window")||document.createElement("canvas"),T=a.getContext("2d"),c=document.createElement("canvas"),p=c.getContext("2d");c.id="pen-canvas";var k=16/9,M;function I(s){M=s,a.width=k*M,a.height=M,c.width=k*M,c.height=M}a.parentElement?.insertBefore(c,a);I(500);var X=class{x;y;dir;scene;hidden;layer;refresh(){S.init().refresh()}constructor(s){this.x=s?.x??0,this.y=s?.y??0,this.dir=s?.dir??0,this.scene=s?.scene??"main",this.hidden=s?.hidden??!1,this.layer=s?.layer??0,S.init().addSprite(this)}touching(s){let e=this.getBoundingBox(),t=s.getBoundingBox();if(!(Math.abs(e.x-t.x)<(e.width+t.width)/2&&Math.abs(e.y-t.y)<(e.height+t.height)/2))return!1;let i=e.x-e.width/2,n=e.y+e.height/2,r=e.x+e.width/2,d=e.y-e.height/2,f=t.x-t.width/2,l=t.y+t.height/2,m=t.x+t.width/2,y=t.y-t.height/2,w=Math.max(i,f),o=Math.min(d,y),L=Math.min(r,m),R=Math.max(n,l),g=L-w,u=R-o;if(g<=1||u<=1)return!1;let x=document.createElement("canvas");x.width=g,x.height=u;let h=x.getContext("2d",{willReadFrequently:!0});h.save(),h.translate(this.x-w,u-this.y+o),h.rotate(this.toRadians(this.dir)),h.fillStyle="red",h.fill(this.getPath()),h.restore();let F=h.getImageData(0,0,g,u).data;h.clearRect(0,0,g,u),h.save(),h.translate(s.x-w,u-s.y+o),h.rotate(this.toRadians(s.dir)),h.fillStyle="blue",h.fill(s.getPath()),h.restore();let z=h.getImageData(0,0,g,u).data;for(let P=3;P<F.length;P+=4)if(F[P]>0&&z[P]>0)return!0;return!1}toRadians(s){return s*Math.PI/180}toDegrees(s){return s*180/Math.PI}move(s){this.x+=s*Math.sin(this.toRadians(this.dir)),this.y+=s*Math.cos(this.toRadians(this.dir)),this.refresh()}turn(s){this.dir+=s,this.refresh()}point(s){this.dir=s,this.refresh()}pointTowards(s,e){this.dir=90-this.toDegrees(Math.atan2(e,s)),this.refresh()}setX(s){this.x=s,this.refresh()}setY(s){this.y=s,this.refresh()}goTo(s,e){this.x=s,this.y=e,this.refresh()}changeX(s){this.x+=s,this.refresh()}changeY(s){this.y+=s,this.refresh()}show(){this.hidden=!1,this.refresh()}hide(){this.hidden=!0,this.refresh()}goToLayer(s){this.layer=s,this.refresh()}changeLayer(s){this.layer+=s,this.refresh()}},S=class D{static instance;loopRunning=!1;gameLoop=null;maxFPS=24;deltaTime=1/this.maxFPS;lastFrame=performance.now();sounds=[];mouseX=0;mouseY=0;mouseDown=!1;mouseClicked=!1;keysPressed=new Set;currentScene="main";sceneMap={};static init(){return this.instance||(this.instance=new D),this.instance}changeScene(e){this.sceneMap[e]||(this.sceneMap[e]={sprites:[],loop:null}),this.loopRunning=!1,this.currentScene=e,this.gameLoop=this.sceneMap[e].loop,this.setMaxFramesPerSecond(this.maxFPS)}setLoop(e,t){if(!this.sceneMap[e]){this.sceneMap[e]={sprites:[],loop:t},e===this.currentScene&&this.changeScene(e);return}this.sceneMap[e].loop=t,e===this.currentScene&&this.changeScene(e)}pauseLoop(){this.loopRunning=!1}resumeLoop(){this.loopRunning=!0,this.setMaxFramesPerSecond(this.maxFPS)}addSprite(e){let{scene:t,layer:i}=e;if(!this.sceneMap[t]){this.sceneMap[t]={sprites:[e],loop:null};return}let n=this.sceneMap[t].sprites.findIndex(r=>r.layer>i);if(n===-1){this.sceneMap[t].sprites.push(e);return}this.sceneMap[t].sprites.splice(n,0,e),this.refresh()}removeSprite(e){let{scene:t}=e;this.sceneMap[t]&&(this.sceneMap[t].sprites=this.sceneMap[t].sprites.filter(i=>i!==e),this.refresh())}async setMaxFramesPerSecond(e){this.maxFPS=e;let t=this.gameLoop;if(t)for(this.loopRunning=!0;this.loopRunning;){let i=this.lastFrame,n=performance.now();this.deltaTime=(n-i)/1e3,this.lastFrame=n,await t(),await this.wait(1e3/e)}}refresh(){T.clearRect(0,0,a.width,a.height),[...this.sceneMap[this.currentScene]?.sprites??[],...this.sceneMap["*"]?.sprites??[]].forEach(e=>{e.hidden||e.draw()})}async wait(e){return new Promise(t=>setTimeout(t,e))}async waitUntil(e){return new Promise(t=>{let i=()=>{e()?t():setTimeout(i,1e3/this.maxFPS)};i()})}hovering(e){let{mouseX:t,mouseY:i}=this,n=t+a.width/2,r=a.height/2-i,d=n-(e.x+a.width/2),f=r-(a.height/2-e.y),l=-this.toRadians(e.dir),m=d*Math.cos(l)-f*Math.sin(l),y=d*Math.sin(l)+f*Math.cos(l);return T.isPointInPath(e.getPath(),m,y)}keyPressed(e){return this.keysPressed.has(e)}playSound(e){let t=new Audio(e);return this.sounds.push(t),t.play(),t}stopSound(e){e.pause(),e.currentTime=0,this.sounds=this.sounds.filter(t=>t!==e)}stopAllSounds(){this.sounds.forEach(e=>{e.pause(),e.currentTime=0}),this.sounds=[]}pickRandom(e,t){return e>t&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1)+e)}sin(e){return Math.sin(this.toRadians(e))}cos(e){return Math.cos(this.toRadians(e))}tan(e){return Math.tan(this.toRadians(e))}csc(e){return 1/Math.sin(this.toRadians(e))}sec(e){return 1/Math.cos(this.toRadians(e))}cot(e){return 1/Math.tan(this.toRadians(e))}asin(e){return this.toDegrees(Math.asin(e))}acos(e){return this.toDegrees(Math.acos(e))}acsc(e){return this.toDegrees(Math.asin(1/e))}asec(e){return this.toDegrees(Math.acos(1/e))}toRadians(e){return e*Math.PI/180}toDegrees(e){return e*180/Math.PI}constructor(){this.setMaxFramesPerSecond(24),c.addEventListener("mousemove",e=>{this.mouseX=e.clientX-c.offsetLeft-c.width/2,this.mouseY=-(e.clientY-c.offsetTop-c.height/2)}),c.addEventListener("mousedown",e=>{this.mouseDown=!0}),c.addEventListener("mouseup",e=>{this.mouseDown=!1}),c.addEventListener("click",e=>{this.mouseClicked=!0,setTimeout(()=>this.mouseClicked=!1,0)}),addEventListener("keydown",e=>{e.repeat||this.keysPressed.add(e.key)}),addEventListener("keyup",e=>{this.keysPressed.delete(e.key)})}},b=class extends X{discriminant="pen";drawing;size;color;getBoundingBox(){return{x:this.x,y:this.y,width:this.size,height:this.size}}getPath(){return new Path2D}draw(){}up(){this.drawing=!1}down(){this.drawing=!0}stamp(s){s.draw(!0)}ereaseAll(){p.clearRect(0,0,a.width,a.height)}dot(){p.fillStyle=this.color,p.fillRect(this.x-this.size/2+a.width/2,-this.y-this.size/2+a.height/2,this.size,this.size)}drawLine(s,e){p.beginPath(),p.moveTo(s+a.width/2,-e+a.height/2),p.lineTo(this.x+a.width/2,-this.y+a.height/2),p.lineWidth=this.size,p.strokeStyle=this.color,p.stroke()}move(s){let e=this.x,t=this.y;this.x+=s*Math.sin(this.toRadians(this.dir)),this.y+=s*Math.cos(this.toRadians(this.dir)),this.drawing&&this.drawLine(e,t),this.refresh()}setX(s){let e=this.x,t=this.y;this.x=s,this.drawing&&this.drawLine(e,t),this.refresh()}setY(s){let e=this.x,t=this.y;this.y=s,this.drawing&&this.drawLine(e,t),this.refresh()}goTo(s,e){let t=this.x,i=this.y;this.x=s,this.y=e,this.drawing&&this.drawLine(t,i),this.refresh()}changeX(s){let e=this.x,t=this.y;this.x+=s,this.drawing&&this.drawLine(e,t),this.refresh()}changeY(s){let e=this.x,t=this.y;this.y+=s,this.drawing&&this.drawLine(e,t),this.refresh()}constructor(s){super(s),this.drawing=s?.drawing??!1,this.size=s?.size??5,this.color=s?.color??"black"}};class B extends b{points;scale;precision;getY(e){const t=this.points;if(t.length<2)throw new Error("Points must have at least 2 elements.");let i=0;for(;i<t.length-1&&e>t[i+1][0];)i++;i>=t.length-1&&(i=t.length-2);const[n,r]=t[i],[d,f]=t[i+1],l=d-n;if(l===0)return r;const m=h=>h===0?(t[1][1]-t[0][1])/(t[1][0]-t[0][0]):h===t.length-1?(t[h][1]-t[h-1][1])/(t[h][0]-t[h-1][0]):(t[h+1][1]-t[h-1][1])/(t[h+1][0]-t[h-1][0]),y=m(i),w=m(i+1),o=(e-n)/l,L=2*o**3-3*o**2+1,R=o**3-2*o**2+o,g=-2*o**3+3*o**2,u=o**3-o**2;return L*r+R*y*l+g*f+u*w*l}render(){const e=this.x,t=this.y;for(let i=0;i<=this.precision;i++){const n=i/this.precision,r=this.points[0][0]+n*(this.points[this.points.length-1][0]-this.points[0][0]),d=this.getY(r);this.goTo(r*this.scale+e-this.points.length*this.scale/2,d*this.scale+t),this.down()}this.up(),this.x=e,this.y=t}setScale(e){this.scale=e,this.update()}setPrecision(e){this.precision=e,this.update()}update(){this.ereaseAll(),this.render()}constructor(e){super(e),this.points=e?.points??[],this.scale=e?.scale??20,this.precision=e?.precision??100,this.render()}}const C=20,O=5,A=S.init(),Y=[];for(let s=0;s<C;s++)Y.push([s,A.pickRandom(0,O)]);const q=120,E=S.init();E.setMaxFramesPerSecond(15);const v=new B({points:Y,scale:40,precision:1});E.setLoop("main",()=>{v.setPrecision(v.precision+1),v.precision>=q&&E.pauseLoop()});
